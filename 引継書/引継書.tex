\documentclass[dvipdfmx,jb5]{jarticle}
\usepackage[top=24truemm,bottom=24truemm,left=20truemm,right=20truemm]{geometry}
\usepackage{amsmath}
\usepackage[]{multicol}
\usepackage{titlesec}
\usepackage{fancyhdr}
\usepackage[dvipdfmx]{graphicx}
\usepackage[dvipdfmx]{color}
\usepackage{color}
\usepackage{url}
\usepackage {fancybox}
\usepackage{jvlisting, listings}
\usepackage[deluxe]{otf}
\usepackage{graphicx}
\usepackage{enumerate}

\title{第62回聖光祭 技術部門 引き継ぎ書}
\author{飼沼 隼 \\ 三枝 義啓 \and 浅井 祐一朗 \\ 矢向 俊貴 \and 李 博之 \\ 黒羽 }
\date{2021年 10 月 9 日}

\begin{document}

\begin{center}

\textbf {
\vspace{8.5cm}
\\
\Ovalbox{\fontsize{33pt}{20pt}\selectfont \scalebox{1}[1.2]{超機密}}\\
\fontsize{55pt}{60pt}\selectfont \scalebox{1}[1.1]{技術部門引継書}\\
\fontsize{12pt}{30pt}\selectfont \scalebox{1}[1.1]{聖光祭実行委員会 拡大実行会議}\\
\fontsize{33pt}{35pt}\selectfont \scalebox{1}[1.1]{第１次中間報告}\\
\fontsize{12pt}{25pt}\selectfont \scalebox{1}[1.1]{聖光祭技術部門}\\
\fontsize{12pt}{15pt}\selectfont \scalebox{1}[1.1]{2021年度業務内容概要}\\
\fontsize{12pt}{20pt}\selectfont \scalebox{1}[1.1]{総括篇}\\
}
\end{center}
\pagebreak
\tableofcontents
\clearpage
 \pagestyle{fancy}
\lhead{\fontsize{8pt}{0pt}\selectfont 聖光祭実行委員会\\技術部門引継書 第１次中間報告}
\section{はじめに}
\subsection{挨拶}
こんばんは。第62回聖光祭技術部門長の飼沼隼\footnote{\url{60050kainuma@seiko.ac.jp}}です。この引継ぎ書では業務内容にとどまらず、細かいアドバイスや体験談も交えてできるだけこれ一枚で全てがわかるようにしていくのでぜひ熟読してください。さて、真面目な話は李が下に書いてくれていますので割愛するとして、みなさんには聖光祭を最大限楽しんでもらうべく必要なことを伝えておきたいと思います。一番大切なのは本気でやることです。僕らは初回の会議から一年半準備してきましたが、ずっと死にかけでした。61期の聖光祭は春開催で本当に大変だと思いますが、幹部全員が全速力でやらないと間に合わないですし、やりきった感皆無の聖光祭と青春になることを忠告しておきます。自分がやるだけでは全く足りないです。サボってる人にやらせるのもお互いがやり続けなければだめです。やる作業はひとつだけ、よくできるところを探して直す、これを繰り返すだけです。可能性は無限大です。期待してます！
\\

これをお読みの方、こんにちは。第62回聖光祭技術副部門長の李博之\footnote{\url{60227li@seiko.ac.jp}}といいます。僕が代表してこの挨拶を書かせていただいていますが、もちろん本書はいろんな人が書いています。さて、本書は2021年10月2日〜同4日に開催された第62回聖光祭において技術部門がどのようなことを行なってきたか、そしてその反省をまとめた引き継ぎ書です。技術部門は他の部門と違い、毎回同じことをする部門ではありません。個人のスキルや人材の量と質に大きく作用されます。個人的にはみなさんができる範囲でベストを尽くして欲しいです。僕はこの時の聖光祭でアプリ局長、HP局長、副部門長などを兼任しており、アプリ局iOS班のリードプログラマでした。また、QRコードシステムと統一シフトを個人的に担当していました。忙しいことこの上ないです。そうゆう観点では人事もかなり重要になります。多忙なひとをできるだけ作らないようにしましょう。その人が足を引っ張ることになります。自分語りはこのくらいにしてそろそろ本題に移ろうと思います。この引き継ぎ書がどのくらい続くのかはわかりませんが、後輩の皆さんには絶大な期待と信頼を寄せています。この部門を仲間とともに立ち上げた身としてはできるだけみなさんの後悔がないようにすべてを終え、次に引き継いでもらいたいです。頑張って下さい。
\subsection{本書の取り扱い}
この引き継ぎ書は技術部門及び技術局発足年に書かれたものであり、基本的なことが多く乗っています。ですので、この引き継ぎ書は引き継ぐことをおすすめします。その年々によって修正や改変、追加などがあれば\TeX ファイルを直接編集するか、それを訂正する形で引き継ぎ書を書くのがいいと思います。また、その年あったことを体験談として書くのもいいと思うので別途準備した方が良さそうです。ですが、この引き継ぎ書で全てがわかる状態にするのであればリンクを貼り付けたりするのがいいと思います。
\subsection{Githubと情報公開}
今年から技術部門及び技術局でGithubOrganizationを運営し、全てのコードをGithubで管理することになりました。プログラマにとってコード整理やバージョン管理は重要な課題であり、聖光祭実行委員会と生徒会の透明化のため情報公開は必要だと考えています。Githubの使い方はAPPENDIXにて解説しています。管理者権限等が引き継がれなかった場合、先代の管理者または \url{60227li@seiko.ac.jp}までご連絡ください。
\subsection{開催時期}
今年2021年は新型コロナウイルス感染症（COVID-19）により開催時期は2021年10月2日〜同4日になりました。準備期間が長く、また夏休みを挟んだということを考慮して以下の引き継ぎをお読みください。

\section{概括}
\subsection{組織構成}
\subsubsection{経緯}
2013年、非公式のIT部門が執行部直属に非公式で爆誕。

2014年、外務部門総合技術研究所が誕生。初代所長 綱井先輩\footnote{\url{53127tsunai@seiko.ac.jp}}。

2015年、第二代。少なくとも動画局は存在した。広報委員長\footnote{Twitter:\url{@ReiFujii}}が在籍しており、機材を揃えていたと聞きます。

2016年、第三代動画作成局とアプリ局の二局が存在した。所長 光藤先輩\footnote{\url{55201mitsudo@seiko.ac.jp}}、動画作成局長は生徒会長の瓜坂先輩\footnote{\url{55031urisaka@seiko.ac.jp}}。

2017年、第四代。この頃の動画局資料は残っていないと思った方がいい。

2018年、第五代。少なくともこの頃には革命が起きていた。傘下に動画局/アプリ局/HP局が存在。所長兼動画局長 香山先輩\footnote{\url{57084koyama@seiko.ac.jp}. 神。センスと動画のスキルはさることながら、後輩の代になっても差し入れをくれる神。元吹奏楽部Sax}、副所長 新城先輩\footnote{\url{57011araki@seiko.ac.jp}. 神。62回の聖光祭にもいらっしゃった。元コンピュータ部サブチーフ}の二人がピンクT。動画局は香山先輩、新城先輩、平野先輩\footnote{\url{57174hirano@seiko.ac.jp}. 神。社畜で、動画の担当数が異常。元コンピュータ部兼展示団体「総合技術研究所」チーフ} の三人＋僕ら60期という感じでした。アプリ局長 [WIP...]

2019年、第六代。58期は前年あまり働いている人がいないのにトップという感じで、カオス。パンフ局はてんてこまいで徹夜続きでした。

2020年、第七代。聖光祭は一般開催では行われなかったが、優秀なエンジニアの所長 沖田先輩\footnote{\url{59039okita@seiko.ac.jp}}や超天才的なスキルとセンスを持ったパンフ局長兼デザイン副課長 柴田先輩\footnote{\url{59091shibataseiko.ac.jp}. 神。元弦オケVc.}など優秀な人材がいた。パンフ副局長兼総技研副所長兼動画局長は飼沼、アプリ局長（ただしみなし幹部）は李、デザイン課長は鈴木瑠之輔\footnote{\url{60111suzuki@seiko.ac.jp}}。

2021年、第八代。部門独立に成功。

\subsubsection{旧組織構成}
（少なくとも2018年）〜2020年の関連する組織構成は以下の通り。
\begin{itemize}
\item 外務部門
  \begin{itemize}
  \item パンフ局
  \item 総合技術研究所
    \begin{itemize}
    \item[−] 動画局
    \item[−] アプリ局
    \item[−] HP局
    \end{itemize}
  \end{itemize}
\item 装飾部門
  \begin{itemize}
  \item デザイン課
  \end{itemize}
\end{itemize}

\subsubsection{現在の組織構成}
第62回聖光祭実施時の生徒会技術局、聖光祭技術部門、体育祭技術局\footnote{体育祭のみ、パンフ局・アプリ局・HP局は実質的に存在しない。}の組織構成は以下の通り。\footnote{図括弧内の数字は役職の定数を表す。} \footnote{兼任は妨げていない。} \footnote{生徒会/聖光祭/体育祭でそれぞれ異なったものがある。}\\
なお、名簿はAPPENDIXに記載するので併せて参照のこと。


\vspace{5mm}
\includegraphics[scale=0.7]{assets/tech.png}\\

\subsubsection{役職}
\subsubsection{人事、そして自覚}
\subsubsection{名称}

\section{ITEC}
 \subsection{機材}
 現在動画局(生徒会)で所有している機材は以下の通りである。
 \begin{itemize}
  \item BlackmagicDesign Pocket Cinema Camera 4K\\
  広報委員会が生徒会予算で購入している。
  \item DJI RSC2\\
  カメラ用ジンバル。動画のプロジェクトで必要な機材として、工藤校長先生に購入していただいた。
  \item グリーンバック\\
  使おうと思って購入したが、結局使っていない。ぜひ使って欲しい。
  \item Windows Desktop PC (自作)\\
 40万くらいかけて自作したPC。CGのレンダリングに最適。
 \end{itemize}
\section{動画局}
\subsection{ソフト}
 動画を作る上で必要なアプリケーションを紹介しておく。
 \begin{itemize}
  \item Adobe系\\
  学校から支給されているものを使えば良いと思う。
  \item Davinci Resolve Studio\\
  カメラを購入した際についてきたものが、生徒会室のPCに割り当てられている。普通に買うと3万円くらいする。カラーグレーディングに最適。
  \item Cinema 4D\\
  CGソフト。40万くらいする映画にも使われているソフトだが、学生は実質無料\footnote{別の会社のプラットフォームを使って購入するため数百円の手数料が取られる}で使える。
  \item Octane\\
  レンダラー。Cinema 4Dと共に使うととてもいい映像が出来上がる。
  有料であるが、予算で落として使うべし。\\ただし、1,2アカウントを何人かで使うことになり、同時に使用することができないので注意が必要。\\生徒会室のPCをレンダリング専用に割り当てたいので、2アカウント購入すべし。
 \end{itemize}
\subsection{動画}
最低限作るべき動画は以下の通り。
 \begin{itemize}
  \item スローガン動画\\
  フルCG。動画
  \item 幹部紹介動画
  \item オープニング動画
  \item グランドフィナーレオープニング動画
  \item エンディング動画
 \end{itemize}

 \section{HP局}
 62回局長：李博之（60227）
 \subsection{ソフト}
 あくまで僕が使用したソフトである。htmlとcssとjsをいじれるならなんだっていい。
  \begin{itemize}
  \item Visual Studio Code\\
  エディタ。自分好みに機能やデザインをカスタムできるため、汎用性が高い。Microsoft社製でもちろん無料。同じようなものでGithubが出してるAtomというものもあり、個人的にはAtomの方がデザインはいいと思う。VSCodeにAtomizeというプラグインを入れてAtom風にしていた。プラグインは後ほどまとめる。
  \item Adobe XD\\
  UI/UX設計ソフト。他のAdobeソフトとの互換性がとてもいい配置ソフト。オブジェクトを配置してサイトのUIを検討することができる。直感的に操作でき、画面遷移もシュミレートできる。ただし、CSSやHTMLを書き出してくれるわけではないので必須ではない。個人的には仮でもUIのイメージがあると作りやすいので必ず使っている。
  \item Adobe Dreamweaver\\
  ウェブアプリ制作の統合型開発環境的なもの。初期段階で使うことを検討していた。ウェブ制作のすべてがここにある。リアルタイムのUIシュミレートやサーバーへの更新設定、サイトの公開もやってくれる神ソフトだが、重いのが難点。パソコンを変えたときにインストールを忘れていて自然消滅した。正直全く不満はなかった。
  \item その他Adobeソフト\\
  デザイン局が忙しそうだったので素材は全部自分で作った。楽しい。illustratorは使えないと恥ずかしい。
  \item FileZilla\\
  いわゆるFTPクライアントソフトというもの。FTPサーバーにファイルをアップロードするときに使う。FFFTPとか有名どころは他にもある。すべてUIが古いWindows感でてて怪しいが全然普通のソフト。FTPについては後ほど解説する。
  \item Firefox Developer Edition\\
  ブラウザ。Chromeでブラウザアカウントを学校アカウントにしてると開発者モードが使えないのでこれを入れた。Developer Editionのとおり、開発者に嬉しい機能が割とある。Chromiumで動いているので環境はあまり変わらないはず。
 \end{itemize}
 \subsection{フレームワーク}
 僕が使用したフレームワーク。
  \begin{itemize}
 \item nuxt.js\\
 サイトが作りやすくなるフレームワーク。流行ってるので使った。必須ではないかな。
 \item firebase\\
 サイトをホスティングするのに使った。詳しくは体験談を読むこと。
 \end{itemize}

 \subsection{スケジュール}
 \begin{itemize}
 \item ベースデザインの確立（1週間）\\
 デザインを設計する上で大切なのは指向となるベースデザインだ。例えばモノクロでいくのか、パステルカラーを使ったハイトーンでいくのか、はたまた原色よりの複雑なデザインにするのか。文面や口で説明するのは非常に難しいがPinterestを使うといい。Pinterestは自分が気に入ったアイディアを保存でき、その傾向によってまたタイムラインを更新してくれるというもので使い方などは各自で調べて欲しい。これを利用することで自分の好きなデザインを集めて考えることができる。スローガンになるべくあったものを探すべきだが自分の場合、これが好きだとおもったデザインに後ほど意味づけを行なった。意味づけとはデザインのオブジェクト一つ一つに意味を持たせることである。この作業は単に意味を頭の中でつけるのではなく、実際にオブジェクトをつけた意味に近いものに修正しながら行う。これをみた1人でもいいからこの意味に気づいて欲しいと思いながらやる。実際はだれもわからないものでもその意味づけの改変がデザインをより良いものとしていく。
 \item オブジェクトの配置（1週間未満）\\
 ベースデザインが決まれば次は実際に作ってみる。紙でもPC上でもホワイトボードや黒板でもいい。一回それを簡単な方法で表現してみる。自分はスケッチブックに一回書いて修正し、ある程度できたら今度はAdobe XDで表現し、また修正するというプロセスを踏んだ。いきなりソースコードを書くと一つのオブジェクトを配置するのに時間がかかる上、修正の小回りが効かない。説明する順番は逆になったがこれが終わったら先述した意味づけを行う。
 \item 環境の構築（1日〜数日）\\
 ローカルにプロジェクトをつくって環境を整える。併せてFirstCommitをしてRemote RepositoryにPushする。
  \item ホームの制作（2週間）\\
  長い時間をかけていいので緻密に作る。載せる内容はトップ\footnote{開いたときに表示されるやつ}、お知らせ\footnote{告知のなかから抜粋}、スローガン\footnote{スローガン動画公開まで非表示}、実行委員長から\footnote{ポエム}、フッター、サイトマップやメニュー。他は自由に追加して構わない。
  \item サイトの公開\\
  聖光祭開催1ヶ月前を目安に公開する。その後、SNSや学校のサイトで宣伝する。個人的には1ヶ月前だと遅い気すらする。
  公開には時間がかかるため、SNSや学校のサイトで告知される前にはもう公開しちゃおう。（どうせ調べても出てこない）その際、しっかりSEO対策\footnote{SEO対策とはGoogleなどの検索エンジンロボットにサイトの内容をより正確に取得してもらうようにすることを指す。}をする。僕はサボっててサイトの説明文すら書いてなかったが途中で気づいて書いた。サイトの公開後はGoogleSearchConsoleにサイトを登録。Google検索で自分のサイトがどれくらい検索されてて掲載順位がどのくらいなのかをみることができる。GoogleRobotがどのくらい来たかもみれる。登録にはサイトの所有者を証明する必要があるため、Googleからもらったhtmlを直下に置いたり、metaタグを追加したりする。所有者が証明できたらとりあえず安心できると思う。3日後ぐらいまでには記録が開始され、掲載順位や訪問者数のグラフが表示されるだろう。
  \item サイトの運営\\
  聖光生や暇な先生って結構優秀で間違いやバグを報告してくる。その報告を治しながら次は他のサイトの制作を始める。
  \item サイトの順次更新\\
  情報がUpdateされるごとにサイトを更新していく。展示団体が確定すれば展示団体一覧を、食品店舗が確定すれば一覧を、校内Mapやスローガン、余裕あれば取材などして記事を投稿するのもいいだろう。ある程度自由にできるので楽しもう。
 \end{itemize}
 \subsection{ウェブサイトを作る上での基本知識}
 余計なお世話かもしれないが、最低でも以下のことは覚えとこう。
 \subsubsection{リクエストとレスポンス}
 端末からサーバーへの問い合わせ（Request）とそれに対する応答（Response）の関係は何があっても覆すことはできない。Requestなしにサーバーがいきなり端末に通信をすることはできないのである。
 \subsubsection{サーバーという概念とURL}
 我々が使うのはおもにファイルサーバーというものである。他にアプリサーバーやDBサーバーが存在する。URLはサーバーに存在する全てのアクセス可能なファイルに対して与えられ、パスと同義である。URLのオーソリティはサーバーを特定しその後は設定したルートファイルからの相対パスになっている。オーソリティはプロトコル、サーバー名、ドメインでできている。例えばPC名www、ドメインseiko.ac.jp内のroot/2021/articles.htmlのファイルのURLはhttps://www.seiko.ac.jp/2021/articleとなる。プロトコルとドメインは次項で解説する。
\subsubsection{プロトコル}
プロトコルとはある通信が何についてのどんな形の通信なのかを表す規定された文字列のことである。当然この世界にはWebサイト以外の通信もあり、物理層、データリンク層、ネットワーク層、トランスポート層、セッション層、プレゼンテーション層、アプリケーション層の7層でできている。下の層になるほど物理的で単調な信号になる。これはあくまでプロトコルの分類の概念である。ちなみにこの概念はOSI参照モデルといって現在はTCP/IPという別の概念が使われている。端的に言えば「何を送るのか」を表しているのである。例えばHTTPはウェブサイト、HTTPSは暗号化されたウェブサイト、SMTPはメールの送信、POPやIMAPはメール受信\footnote{厳密には移動とコピーの違いあり}、FTPはファイルやフォルダーの送信などがある。アクセスしたファイルをどんな形で取ってくるのかを表し、ブラウザがレンダリングするときに使われる。
\subsubsection{ドメインとサイト取得までの流れ}
今回は作りたての学校のHP http://www.seiko.ac.jp/ に自宅にあるPCから始めてアクセスした時を考えてみる。\footnote{なんでhttpなんだよ...} まず、URLを叩く。その通信は無線LANで繋がっているルーターから自宅地下の電話線を通り近くのキャリア基地局までくる。データセンタとも呼ばれるところである。\footnote{Googleデータセンタなどのデータセンタとは別物}URLはネットの住所ではないのでURLだけで直接どこかにアクセスことはできない。使用するのはIPアドレスであり、とりあえず聖光HPのIPアドレスを探したい。ここで一度基地局内のキャッシュサーバを通しキャッシュから探す。以降のキャッシュサーバでも同じだが今回はサイトも端末も新しいのでキャッシュにはないとする。キャッシュサーバ通したときにあればそこで折り返されると考えて良い。今回はキャッシュにないので権威DNSサーバにアクセスする。ドメインは逆側から読む\footnote{今気づいたけど外国の住所と同じやな}のでjp >| ac >| seikoという構造である。権威DNSはjpノードに案内し、jpノードはsc（教育機関）ノードに案内する。そしてscノードにはseikoという名前のサーバのIPが登録してありこれを取得するという形でURLとIPの交換が完了した。ドメインは入れ子構造になっていて逆から読むということは覚えとくべき。もらったIPを使えば簡単に聖光のルータにアクセスできる。ルータからPC名（今回はwww）を渡すことでパソコン内のルートフォルダにアクセスする。パスには今回何も書かれてないが/で終わることは暗示的にindex.htmlを指すことが設定されてるはず\footnote{場合によってdefault.htmlなど、サーバ側の設定で変えることはできる}なのでindex.htmlを取得し端末に帰っていく。
\subsubsection{サイトのレンダリング}
HTTP通信のうち、サイトのhtmlを取得したりする\footnote{一般化するとdoGet()をコールするということだが}ことをGET通信と呼ぶ。これに対して、サーバに対して情報を渡すときに使うのがPOST通信である。先述したindex.htmlをGETするのが第1ステップになっており、そのhtmlを取得したブラウザは\verb|<head>|タグを読む。そこには\verb|<link>|タグや \verb|<script>|タグでcssやjsが紐づけられており、今度はこのcssやjsをGETしにいく。その間に\verb|<body>|タグ内を読み、\verb|<img>|タグや\verb|<video>|タグ、\verb|<iframe>|タグなどのリソースを取りに行く。また、読み込んだ\verb|<body>| タグ内のオブジェクトを描画し、cssをもとに再描画。\footnote{この間僅かなので見えない。ネットが遅いと見れる。}最後に\verb|<img>|タグや\verb|<video>|タグ、\verb|<iframe>|タグなどのリソースが届き、当てはめる。javascriptが実行され、すべての作業は終了する。以上を見るに何回もGETを繰り返してるのがわかる。これは開発者モードで見ることができる。
\subsubsection{FTPクライアントの使い方}
FTPサーバにファイルを送信したり取得するときは「FTPユーザ名」と「FTPパスワード」と「FTPホスト」が必要である。「FTPユーザ名」はドメインと同じなのでseikofes.official.jp。また、FTPホストはsv64.star.ne.jp。この三つは一緒にITEC長のパスワード一覧的なものに掲載してもらってる（はず）なので、部門長に問い合わせてみること。FTPクライアントに少し名称は違うかもしれないが、この三つを入力する。あとは接続ボタンを押せばOK。僕が使ったFileZillaは左側にローカルのファイルツリー、右側はFTPサーバのファイルツリーが表示されており、ドラッグ\&ドロップでファイルを移動できるようになっていた。また、Starserverの方からもアクセスでき、ファイルのアップロードはできないが確認としては役立つだろう。
 \subsection{反省点\&注意次項}
 \subsubsection{顧問挨拶}
 部門の顧問の生成と挨拶するときにかならず「starserverの代金は払っているかの確認」をしてもらうようにすること。今年2021年、3人の先生に確認して「払っている」と言われていたが結局、支払い催促メールが届いていた seikofesta@gmail.com を誰も見ておらず、契約解除となってしまった。（もともとは　seikofesta.official.jp だったと記憶している）seikofesta@gmail.com にアクセスできる唯一の先生が夏季休暇のため音信不通になってしまったのも起因してしまった。夏休み中は先生と連絡できるとは限らないのでもし、聖光祭の開催時期が2学期だった場合、注意が必要である。
 \section{アプリ局(Android)}
 \subsection{各画面について}
 \subsubsection{マップ}
 まず地図の画像はパンフが出来上がったらその画像を使うとよい。出来上がるまでは途中経過の地図を使ってプログラムを書いてく。地図の画像、展示団体等の位置を識別するための画像、ピンの画像、タブレイアウトをおくためのFragment、タブレイアウト内に表示するためのFragment、タブレイアウトの機能を実装するためのAdapterはおそらく必要となる。加えて、地図の操作を行うためのカスタムビュー等も用意することになるだろう。
次に、各機能の詳細について書いていく。
タブで階数ごとに違うマップを出すようにする。タブレイアウトはここをみればわかると思うので詳細は省略する。
マップのドラッグ、ズームについては画像をMatrixを使用して移動、拡大縮小するのがよい(画像の座標や、拡大率とかを保存しておくと後々楽になり、Matrixならそれらを保存してくれるから)。描画方法はimageViewを用いる方法とcanvasを使用する新しくViewを作って用いる方法などがあるが今年はimageViewを使用した。どちらもMatrixを使用して移動等が可能。ドラッグやズーム等の検知はGestureDetectorを使って検出した。ドラッグはonScroll、ズームはonScaleで係数を取得することが可能。地図の端に到達した判定は、どこを端と定義するかによるが、今年は「画像の端がスクリーンの真ん中を超える」という判定とした。地図の端をどう定義するかは、色々な外部のサービスを参考にすると良い。慣性は余裕があるならば実装するのが良いが、少し厄介であるため無理して実装しなくてもよい。今年は慣性をonFlingで取得しTimerで動かした。また、画像の端を超えたあとや、ズームで縮小しすぎたあとに戻す処理でもTimerを使用し、滑らかな動きを実装した。
マップの操作云々を調べて自分なりの実装が難しいと感じたら李ひろゆきのQiitaを参考にしてください。
「タップした場所がどこなのか」を判別する方法は、別途、各展示、食品で色分けされた画像を元に判別する。タップしたスクリーンの座標から、画像の位置座標と拡大率を用いてタップした画像の中の座標を算出し、色分けされた画像のその座標が何色かで判別する。今年は、\verb+ #FF00XX(XX / 2 = id) +が展示、\verb+ #00FFXX(XX / 5 = id) +が食品と決め、色識別用画像を作成した。画像を作るのは自分でやったが、信頼できるなら後輩に頼むと仕事が減る。色識別用画像を作る際、拡大縮小等でボケて、想定していなかった色が検出されないよう気をつけること。
詳細画面のピンの座標はデータベースに0~1の範囲で、x,y座標それぞれの割合を記録しておき、表示する際その値から画像用の座標を計算しピンを指してる。この0~1の範囲の座標を計算するにあたり、スプレッドシートを使って計算するのがもっとも効率的と思われる。参考程度に今年使った自分用スプシをここに置いておく。
最後に、地図を表示するには、大きな地図の画像を用意する必要があるが、その際に重すぎて落ちないよう気をつけること。
 \section{アプリ局(iOS)}
 \section{デザイン局}
 \section{特別業務}
 ここでは「本来の局の業務」から逸脱した業務について記す。
 \subsection{統一シフト}
 62回担当者：李博之（60227）
  \subsubsection{導入前のシフト}
  統一シフトによってどんなことができるようになったかについて書く。統一シフト導入前は主に各団体や部門が作ったシフトをメールやLINEで部門員や団体員に送るという形だった。シフトがダブルブッキングした場合はお互いの長で話し合い、解決していたと思われる。第59回聖光祭ではスプレッドシートを使った初めての統一シフトが行われた。これを旧統一シフトと呼ぶことにする。この旧統一シフトは全団体、全部門に優先順位をつけてその順番に各団体からある程度埋まったシフト表を回収してそれを一つのスプレッドシートに入れていくという作業を何回も繰り返すというものだった。当然それぞれで作ったシフト表なので被りがでてくる。被りはまたその優先度が決められており、基本的には団体の優先順位が適応されるが、昼時の食品店舗や、演目への出演はその部分だけ優先される。負けた場合はそこが入らなかったということを記入してまた団体に返す。そして再び集めるというのを短いスパンで何回も繰り返したそうだ。
  \subsubsection{統一シフトの概要}
  第61回聖光祭から僕が作った統一シフトシステムを運用することになった。結局第61回は内部開催になったので運営はできなかった。それでは説明していく。まず、一番簡単な方法として考えられるのはみんなでスプレッドシートを編集するということである。しかし、編集権限を渡してしまえば好きなような改ざんできたり、形式もバラバラになってしまう。そこで、それをオーバーラップする形でシステムを組んだ。スプレッドシートをわかりやすく表示したり、入力方法を選択制にしたり、ログイン制を実装している。
  \subsubsection{仕事内容という概念}
  ネーミングを適当にしたらそれを報告書に書かれてしまい、そのまままかり通ってしまった用語「仕事内容」に関して説明する。仕事内容とは印刷時に印刷される文字のことでどこで何をするかを端的に表したものである。\verb+A-B-C+の形になっており、　部門であればAに部門名（略称）、部門でなければAには\verb+展示団体、食品店舗、その他+が入る。部門でない場合にはBに団体名（略称）が入る。部門であればBとC、そうでなければCには自由な語を入れることができる。これによって完成した仕事内容は一つの業種として各団体にストックされ、団体は必要な仕事内容をすべてあらかじめ申告する。統一シフト入力サイトでストックした仕事内容の束から選んで入力するのだ。団体それぞれ、シフト入力前に必要となるであろう仕事内容を考えるというわけだ。また、それぞれの仕事内容には優先度が決められており、上書きする場合にはもともと入ってる仕事内容より優先度が高い（同値も含む）もののみ認められる。
  \subsubsection{構成}
  \begin{itemize}
  \item Google Spread Sheet\\
  DB。データを格納する。
   \item Google Apps Script\\
   DBからデータを抽出したり参照したりしてログイン、統一シフトの取得と編集、仕事内容の取得などを行なっている。サーバー代わり。
   \item Nuxt.js + Scss + Typescript\\
   Webサイトの構成。Nuxt学んだし、王道な構成でやろうと思った次第。
   \item jQuery\\
   Ajax通信したいので入れた。
   \item Firebase\\
   作ったWebサイトをホストするためにFirebase Hostingを使った。
  \end{itemize}
  \subsubsection{統一シフト関係のスプレッドシート}
  地獄である。
  \begin{itemize}
  \item 統一シフト\\
  統一シフト。1日目、2日目、3日目のシートがある。列はシフト開始時間（10分単位）、行は学籍番号を表している。列の初めのいくつかの列は順番とか決まってるので変えないこと。変えるのならばGAS側とWebサイト側も変える必要が出てくる。
  \item 関連情報一覧\\
  ログイン情報と仕事内容一覧が書いてある。運営中はここを主に編集することになる。書いてあるものが動いているのでここから抜けばログインできなくなったり、仕事内容一覧に表示されなくなったりする。
  \end{itemize}
 \subsection{入場システム}
 \subsection{オンライン食品予約システム}
 \subsection{講堂予約システム}
 \subsection{電子決済}
 今年度導入された電子決済では、Squareという企業の機器を用いている。\\
 クレジットカードから交通系ICまで幅広い決済方法に対応している。\\
 \includegraphics[scale=0.15]{assets/square_availability.png}
 \subsubsection{注意事項}
 Squareを用いる上で注意事項がある。
 \begin{enumerate}[注意1]
  \item 手数料が発生する\\
  第62回聖光祭では、執行部予算で合計で二万五千円\footnote{全体の2〜3％ほど}の手数料を補充した。
  \item 収益は生徒会の口座に振り込まれる\\
  生徒会(石渡先生)が持っている銀行口座に振り込まれる。
  \item ピロティはWi-Fiが使えない\\
  ピロティではiPadが学校のWi-Fiに繋がらないので、一部食品店舗で電子決済を導入する場合はポケットWi-Fiをレンタルするか、山口先生\footnote{\url{yuri.ayamguchi@seiko.ac.jp}}に頼んで、Wi-Fiの子機を設置していただくと良い。\footnote{第62回聖光祭では食品予約システムが停止されていたため、余っていたポケットWi-Fiを割くことができたが、食品予約システムをやるのであれば、子機を設置する方が良いだろう。}
 \end{enumerate}
 \subsubsection{必要な機材}
 \begin{itemize}
  \item Square リーダー （本体）\\
  ほぼ全ての電子決済はここで処理できる。
  \item Square リーダー （磁気専用リーダー）\\
  \includegraphics[scale=0.2]{assets/square_reader2.png}\\
  一部の古いクレジットカードでSquareで読み取れない場合はこれを用いる。
  \item iPad\\
  決済を行うのに用いる。
 \end{itemize}
 \subsubsection{使い方}
 \begin{itemize}
  \item クレジットカード
  \begin{itemize}
  \item ICカード
  \begin{enumerate}[手順1]
   \item Square リーダー上部にあるカードスロットに、ICカードのオモテ面を上にしてICチップのある側からカードを挿入する。\\
   \includegraphics[scale=0.4]{assets/square_insert-card.png}
   \item カードは差し込んだままにし、 Square リーダーから「ピー」と音が鳴って、\\緑色のランプが4つ{\color{green}●●●●}点灯したらカードを取り出す。
   \item お客様にiPadの画面に指でサインをもらい決済を完了する。
  \end{enumerate}
  \item 磁気テープカード\\
  リーダーをiPadのイヤホンジャックに差し込み、磁気テープのみのクレジットカードをスワイプする。
  \includegraphics[scale=0.4]{assets/square_slide-card.png}
  \end{itemize}
  \item 電子マネー\\
  交通系IC、QUICPay、iDでの決済
  \begin{enumerate}[手順1]
   \item 「電子マネー」をタップ。
   \item お客様が希望する決済方法を選択。
   \item 青色のランプが4つ{\color{blue} ●●●●}点滅し、画面が「お待ちください。準備をしています。」から「交通系ICカード/iD/QUICPayカードをSquare リーダーにタッチしてください。決済音が鳴るまで動かさないでください。」に変わる。お客様に支払い金額を確認いただき、カードもしくはモバイル端末をSquare リーダーにタッチしてもらう。
   \item POSレジから「ピピッ」と決済音が鳴ったら決済完了。
  \end{enumerate}
 \end{itemize}

\subsection{展示団体入退場管理システム}
\subsection{入場システム}
\section{さいごに}
\section{APPENDIX}
\subsection{Githubの使い方}
\subsection{技術局名簿}
\end{document}
